<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loading-indicator" style="display: none;">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <header>
        <h1>API Tester</h1>
        <div class="theme-mode-group">
            <button class="theme-mode-btn" data-theme-mode="system" title="System Theme">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-display" viewBox="0 0 16 16">
                    <path d="M0 4s0-2 2-2h12s2 0 2 2v6s0 2-2 2h-4v1h3a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2h3v-1H2s-2 0-2-2V4zm2-1a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H2z"/>
                </svg>
            </button>
            <button class="theme-mode-btn" data-theme-mode="light" title="Light Theme">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun" viewBox="0 0 16 16">
                    <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zM8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm-5-5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm10 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zM4.222 4.222a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 0 1-.707.707L4.222 4.93a.5.5 0 0 1 0-.707zm9.193 9.193a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 0 1-.707.707l-1.414-1.414a.5.5 0 0 1 0-.707zM4.222 11.778a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1-.707.707l-1.414-1.414a.5.5 0 0 1 0-.707zm9.193-9.193a.5.5 0 0 1 0 .707l-1.414 1.414a.5.5 0 1 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0z"/>
                </svg>
            </button>
            <button class="theme-mode-btn" data-theme-mode="dark" title="Dark Theme">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon" viewBox="0 0 16 16">
                    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 7.71 14.85c4.021 0 7.277-3.278 7.277-7.318 0-1.817-.67-3.478-1.755-4.744A7.334 7.334 0 0 0 4.858 1.311z"/>
                </svg>
            </button>
            <button id="open-new-window-btn" class="theme-mode-btn" title="Open New Window">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
            </button>
            <button id="clear-all-data-btn" class="theme-mode-btn" title="Clear All Storage Data">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
            </button>
        </div>
    </header>

    <main>
        <section class="main-section">
            <details class="settings-details" open>
                <summary>1. Provider Settings</summary>
                <fieldset>
                    <label for="provider-select">Provider:</label>
                    <select id="provider-select">
                        <option value="openai_compatible" selected>OpenAI Compatible</option>
                        <option value="openai">OpenAI</option>
                        <option value="deepseek">Deepseek</option>
                        <option value="antrophic">Antrophic</option>
                        <option value="openrouter">OpenRouter</option>
                    </select>

                    <div id="base-url-container" style="display: none;">
                        <label for="base-url-input">Base URL:</label>
                        <input type="text" id="base-url-input" placeholder="Enter Base URL">
                    </div>

                    <label for="api-key-input">API Key:</label>
                    <input type="password" id="api-key-input" placeholder="Enter your API Key">
                </fieldset>
            </details>
        </section>
        <section class="main-section">
            <details class="settings-details">
                <summary>Provider Configurations</summary>
                <fieldset>
                    <label for="config-name-input">Configuration Name:</label>
                    <input type="text" id="config-name-input" placeholder="e.g., My Work Account, Groq Llama3">
                    <button id="save-config-btn">Save Current Configuration</button>
                    
                    <div id="saved-configs-list-container">
                        <hr class="config-separator">
                        <h3 class="saved-configs-title">Saved Configurations</h3>
                        <div id="saved-configs-list">
                            <!-- Saved configurations will be dynamically inserted here -->
                        </div>
                    </div>
                </fieldset>
            </details>
        </section>

        <section class="main-section">
            <details class="settings-details" open>
                <summary>2. Generation Task</summary>
                <fieldset>
                    <div class="generation-type-selector">
                        <span class="main-label">Generation Type:</span>
                        <div class="radio-group-wrapper">
                            <label class="radio-label" for="generation-type-text">
                                <input type="radio" id="generation-type-text" name="generation-type" value="text" checked>
                                <span>Text</span>
                            </label>
                            <label class="radio-label" for="generation-type-image">
                                <input type="radio" id="generation-type-image" name="generation-type" value="image">
                                <span>Image</span>
                            </label>
                            <label class="radio-label" for="generation-type-audio">
                                <input type="radio" id="generation-type-audio" name="generation-type" value="audio">
                                <span>Audio</span>
                            </label>
                            <label class="radio-label" for="generation-type-video">
                                <input type="radio" id="generation-type-video" name="generation-type" value="video">
                                <span>Video</span>
                            </label>
                        </div>
                    </div>

                    <div id="model-container">
                        <label for="model-select">Model:</label>
                        <div class="model-selection-wrapper">
                            <select id="model-select"></select>
                            <button id="refresh-models-btn" class="icon-btn" title="Refresh Model List">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                                </svg>
                            </button>
                        </div>
                        <input type="text" id="custom-model-input" placeholder="Enter custom model name" style="display:none; margin-top: 8px;">
                    </div>
                    <label for="prompt-input" id="prompt-label">Prompt / Image Description:</label>
                    <button id="upload-text-btn" class="upload-btn" title="Upload a file for prompt">Upload File</button>
                    <textarea id="prompt-input" rows="4" placeholder="Enter text prompt or image description..."></textarea>
                </fieldset>
            </details>
        </section>

        <section class="main-section">
            <details class="settings-details">
                <summary>3. Advanced Options</summary>
                <fieldset>
                    <!-- Text Options -->
                    <div id="text-generation-options">
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-system-prompt-checkbox">
                                <span>System Prompt</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-system-prompt-checkbox" checked>
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group" id="system-prompt-group">
                            <textarea id="system-prompt-input" rows="2" placeholder="Enter system prompt..."></textarea>
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-temperature-checkbox">
                                <span>Temperature</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-temperature-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group slider-group" id="temperature-group">
                            <label for="temperature-input">Temperature: <span id="temperature-value">1.0</span></label>
                            <input type="range" id="temperature-input" min="0" max="2" step="0.1" value="1">
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-top-p-checkbox">
                                <span>Top P</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-top-p-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group slider-group" id="top-p-group">
                            <label for="top-p-input">Top P: <span id="top-p-value">1.0</span></label>
                            <input type="range" id="top-p-input" min="0" max="1" step="0.01" value="1">
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-top-k-checkbox">
                                <span>Top K</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-top-k-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group slider-group" id="top-k-group">
                            <label for="top-k-input">Top K: <span id="top-k-value">50</span></label>
                            <input type="range" id="top-k-input" min="0" max="1000" step="50" value="50">
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-max-tokens-checkbox">
                                <span>Max Tokens</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-max-tokens-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group" id="max-tokens-group">
                            <label for="max-tokens-input">Max Tokens:</label>
                            <input type="number" id="max-tokens-input" placeholder="e.g., 4096">
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-reasoning-effort-checkbox">
                                <span>Reasoning Effort</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-reasoning-effort-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group" id="reasoning-effort-group">
                            <label for="reasoning-effort-select">Reasoning Effort:</label>
                            <select id="reasoning-effort-select">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="enable-param-container">
                            <label class="enable-param-title" for="enable-custom-params-checkbox">
                                <span>Custom Parameters</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-custom-params-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group custom-params-form" id="custom-params-group">
                            <div class="custom-params-input-wrapper">
                                <label for="custom-params-input" class="custom-params-label">
                                    <span class="label-text">Custom Parameters (JSON format)</span>
                                    <span class="help-tooltip" title="Enter additional API parameters as valid JSON. These will be merged with the request body.">?</span>
                                </label>
                                <div class="textarea-container">
                                    <textarea
                                        id="custom-params-input"
                                        rows="5"
                                        placeholder='{
  "min_p": 0.1,
  "repeat_penalty": 1.1,
  "frequency_penalty": 0.5
}'></textarea>
                                    <div class="json-actions">
                                        <button type="button" id="format-json-btn" class="json-action-btn" title="Format JSON">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="16 18 22 12 16 6"></polyline>
                                                <polyline points="8 6 2 12 8 18"></polyline>
                                            </svg>
                                        </button>
                                        <button type="button" id="clear-json-btn" class="json-action-btn" title="Clear JSON">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="custom-params-help">
                                <div class="help-section">
                                    <h4>Common Parameters:</h4>
                                    <div class="param-examples">
                                        <span class="param-example" data-param='{"min_p": 0.1}'>min_p</span>
                                        <span class="param-example" data-param='{"repeat_penalty": 1.1}'>repeat_penalty</span>
                                        <span class="param-example" data-param='{"frequency_penalty": 0.5}'>frequency_penalty</span>
                                        <span class="param-example" data-param='{"presence_penalty": 0.3}'>presence_penalty</span>
                                        <span class="param-example" data-param='{"mirostat": 2}'>mirostat</span>
                                        <span class="param-example" data-param='{"tfs_z": 1.0}'>tfs_z</span>
                                    </div>
                                </div>
                                <small class="help-text">
                                    <strong>Tips:</strong> Click parameter examples to add them. Parameters will be merged with the request body.
                                    Ensure valid JSON format for compatibility across providers.
                                </small>
                            </div>
                        </div>
                        <div class="enable-streaming-container">
                            <label class="enable-streaming-title" for="enable-streaming-checkbox">
                                <span>Streaming</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-streaming-checkbox" checked>
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Image Options -->
                    <div id="image-options-container" style="display: none;">
                        <div class="enable-quality-container">
                            <label class="enable-quality-title" for="enable-quality-checkbox">
                                <span>Enable Quality</span>
                                <span class="switch">
                                    <input type="checkbox" id="enable-quality-checkbox">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div id="quality-options-container">
                            <label for="quality-select">Image Quality:</label>
                            <select id="quality-select">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="auto">Auto</option>
                                <option value="standard">Standard</option>
                                <option value="hd">hd</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="text" id="custom-quality-input" placeholder="Enter custom quality" style="display:none;">
                        </div>
                        <label>Image Size (Width x Height):</label>
                        <div class="size-inputs">
                            <input type="number" id="image-width-input" placeholder="Width" value="1024" min="1">
                            <span>x</span>
                            <input type="number" id="image-height-input" placeholder="Height" value="1024" min="1">
                        </div>
                        <small>Note: Most models only support specific resolutions (e.g., 1024x1024, 512x512). Check provider documentation.</small>
                    </div>

                    <!-- Audio Options -->
                    <div id="audio-options-container" style="display: none;">
                        <label for="audio-type-select">Audio Type:</label>
                        <select id="audio-type-select">
                            <option value="tts" selected>Text-to-Speech (TTS)</option>
                            <option value="stt">Speech-to-Text (STT)</option>
                        </select>
                        <div id="stt-input-container" style="display: none;">
                            <label for="audio-file-input">Audio File:</label>
                            <input type="file" id="audio-file-input" accept="audio/*">
                        </div>
                        <div id="recorder-controls" style="display:none;">
                            <button type="button" id="record-btn">Start Recording</button>
                            <audio id="recording-preview" controls style="display:none;"></audio>
                        </div>
                        <div id="voice-options-container" style="display:none;">
                            <label for="voice-input">Voice:</label>
                            <input type="text" id="voice-input" placeholder="Enter voice name">
                        </div>
                    </div>

                    <!-- Video Options -->
                    <div id="video-options-container" style="display: none;">
                        <div class="enable-aspect-ratio-container">
                            <label class="enable-aspect-ratio-title" for="video-aspect-ratio-enabled">
                                <span>Enable Aspect Ratio</span>
                                <span class="switch">
                                    <input type="checkbox" id="video-aspect-ratio-enabled" onchange="toggleAspectRatio()">
                                    <span class="slider"></span>
                                </span>
                            </label>
                        </div>
                        <div class="form-group" id="aspect-ratio-group" style="display: none;">
                            <label for="video-aspect-ratio">Aspect Ratio:</label>
                            <select id="video-aspect-ratio">
                                <option value="16:9">16:9 (Widescreen)</option>
                                <option value="9:16">9:16 (Portrait)</option>
                                <option value="1:1">1:1 (Square)</option>
                                <option value="4:3">4:3 (Standard)</option>
                                <option value="21:9">21:9 (Ultrawide)</option>
                            </select>
                            <!-- Note: Aspect Ratio select is controlled by Enable Aspect Ratio,
                                 so it doesn't need an individual toggle. -->
                        </div>
                        <div class="form-group form-group-toggle">
                            <label for="video-duration">Duration (seconds):</label>
                            <input type="number" id="video-duration" min="1" max="60" value="5" placeholder="Duration in seconds">
                            <!-- Toggle switch for video duration removed as requested -->
                        </div>
                    </div>
                </fieldset>
            </details>
        </section>

        <button id="send-button">Generate</button>
        <button id="stop-button" style="display: none; background-color: #dc3545; color: white;">Stop Generating</button>

        <div id="output-area">
            <p id="output-text"></p>
            <img id="output-image" src="" alt="Generated Image" style="display: none;">
            <audio id="output-audio" controls preload="metadata" style="display:none;"></audio>
            <video id="output-video" controls preload="metadata" style="display:none;">
                Your browser does not support the video tag.
            </video>
            <div class="download-buttons-container">
                <a id="download-image-btn" href="" download style="display:none;">Download Image</a>
                <a id="download-audio" href="" download style="display:none;">Download Audio</a>
                <a id="download-video-btn" href="" download style="display:none;">Download Video</a>
            </div>
        </div>

        <div id="stats-area"></div>

        <div id="payload-container" style="display: none;">
            <div class="payload-buttons-container">
                <button id="toggle-payload-btn" class="payload-toggle-btn">Show Request</button>
                <button id="toggle-response-btn" class="payload-toggle-btn">Show Response</button>
            </div>
            <pre id="payload-display-area" class="payload-display" style="display: none;"></pre>
            <pre id="response-display-area" class="payload-display" style="display: none;"></pre>
        </div>
    </main>

    <script src="script.js"></script>
</body>
</html>
